<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Mirror - Mood Quotes</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.12.2/ml5.min.js"></script>
  <style>
    body { background: black; color: white; text-align: center; }
    #quote { font-size: 1.5rem; margin-top: 10px; }
    #cameraSelect { 
        margin: 10px auto;
        padding: 5px;
        background: #333;
        color: white;
        border: 1px solid #666;
    }
  </style>
</head>
<body>
  <h1>ü™û AI Mirror</h1>
  <select id="cameraSelect">
        <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á...</option>
  </select>
  <video id="video" width="320" height="240" autoplay muted playsinline></video>
  <div id="quote">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå...</div>

  <script>
    const video = document.getElementById('video');
    const quoteDiv = document.getElementById('quote');
    const cameraSelect = document.getElementById('cameraSelect');
    const moodQuotes = {
      happy: ["‡∏¢‡∏¥‡πâ‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏•‡∏Å‡∏™‡∏î‡πÉ‡∏™ üåû", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡∏ô‡∏∞ üòÅ", "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏î‡∏π‡∏î‡∏µ‡∏°‡∏≤‡∏Å!"],
      sad: ["‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏ô‡∏∞ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏°‡∏±‡∏ô‡∏Å‡πá‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô üíô", "‡πÄ‡∏®‡∏£‡πâ‡∏≤‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Æ‡∏∂‡∏ö‡∏™‡∏π‡πâ ‚ú®"],
      angry: ["‡πÉ‡∏à‡πÄ‡∏¢‡πá‡∏ô‡πÜ ‡∏ô‡∏∞ ‡∏™‡∏π‡∏î‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏∂‡∏Å‡πÜ üòå", "‡πÇ‡∏Å‡∏£‡∏ò‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡πÄ‡∏ú‡∏≤‡πÉ‡∏à üî•"],
      neutral: ["‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡∏π‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡∏ô‡∏∞ üò∂", "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡∏°‡πà‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?"],
    };

    async function getCameras() {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const videoDevices = devices.filter(device => device.kind === 'videoinput');
        cameraSelect.innerHTML = videoDevices.map(device =>
            `<option value="${device.deviceId}">${device.label || `Camera ${videoDevices.indexOf(device) + 1}`}</option>`
        ).join('');
    }

    async function setupCamera() {
        const constraints = {
            video: {
                deviceId: cameraSelect.value ? { exact: cameraSelect.value } : undefined
            }
        };
        if (video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        return new Promise(resolve => video.onloadedmetadata = resolve);
    }

    cameraSelect.onchange = async () => {
        await setupCamera();
    };

    async function startFaceAPI() {
      await getCameras();
      await setupCamera();
      const faceapi = ml5.faceApi(video, { withExpressions: true }, modelReady);

      function modelReady() {
        console.log("FaceAPI ready!");
        detect();
      }

      function detect() {
        faceapi.detectSingle(gotResults);
      }

      function gotResults(err, result) {
        if (result && result.expressions) {
          const sorted = Object.entries(result.expressions).sort((a, b) => b[1] - a[1]);
          const topEmotion = sorted[0][0];
          const quotes = moodQuotes[topEmotion] || ["‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤ ü§î"];
          quoteDiv.textContent = quotes[Math.floor(Math.random() * quotes.length)];
        }
        detect(); // loop
      }
    }

    startFaceAPI();
  </script>
</body>
</html>
