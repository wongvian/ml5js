<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡πâ‡∏ß‡∏¢ AI</title>
    <script src="p5.min.js"></script>
    <script src="ml5.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 1200px;
            width: 100%;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .control-group label {
            font-size: 0.9rem;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        select, button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        select:hover, button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .camera-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .status.loading {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
        }

        .status.ready {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid rgba(40, 167, 69, 0.5);
        }

        .status.error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.5);
        }

        .object-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .object-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .object-item:last-child {
            border-bottom: none;
        }

        .confidence-bar {
            width: 60px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡πâ‡∏ß‡∏¢ AI</h1>
        <p>‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ Machine Learning ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
    </div>

    <div class="container">
        <div class="controls">
            <div class="control-group">
                <label>üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á</label>
                <select id="cameraSelect">
                    <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πâ‡∏≠‡∏á...</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>üéØ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö</label>
                <select id="objectFilter">
                    <option value="all">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                    <option value="person">‡∏Ñ‡∏ô</option>
                    <option value="car">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</option>
                    <option value="motorcycle">‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
                    <option value="bicycle">‡∏à‡∏±‡∏Å‡∏£‡∏¢ÿßŸÜ</option>
                    <option value="bottle">‡∏Ç‡∏ß‡∏î</option>
                    <option value="cup">‡πÅ‡∏Å‡πâ‡∏ß</option>
                    <option value="book">‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
                    <option value="cell phone">‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</option>
                </select>
            </div>
            
            <button id="startBtn" class="btn-primary">üé¨ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
            <button id="resetBtn" class="btn-danger">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
            <button id="pauseBtn" class="btn-secondary" style="display: none;">‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</button>
        </div>

        <div id="status" class="status loading">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...</div>

        <div class="camera-container">
            <div id="videoContainer"></div>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="currentCount">0</div>
                <div class="stat-label">üëÅÔ∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="confidence">0%</div>
                <div class="stat-label">üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="fps">0</div>
                <div class="stat-label">‚ö° FPS</div>
            </div>
        </div>

        <div id="status" class="status loading">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...</div>

        <div class="object-list" id="objectList" style="display: none;">
            <h3 style="margin-bottom: 10px;">üîç ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö:</h3>
            <div id="detectedObjects"></div>
        </div>
    </div>

    <script>
        let video;
        let detector;
        let detections = [];
        let totalObjectsPassed = 0;
        let isDetecting = false;
        let previousObjects = [];
        let objectFilter = 'all';
        let isPaused = false;
        
        // FPS calculation
        let lastTime = 0;
        let frameCount = 0;
        let fps = 0;

        // Elements
        const statusEl = document.getElementById('status');
        const totalCountEl = document.getElementById('totalCount');
        const currentCountEl = document.getElementById('currentCount');
        const confidenceEl = document.getElementById('confidence');
        const fpsEl = document.getElementById('fps');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const cameraSelect = document.getElementById('cameraSelect');
        const objectFilterSelect = document.getElementById('objectFilter');
        const objectListEl = document.getElementById('objectList');
        const detectedObjectsEl = document.getElementById('detectedObjects');

        function preload() {
            // ml5.js will be loaded
        }

        function setup() {
            const canvas = createCanvas(800, 600);
            canvas.parent('videoContainer');
            
            updateStatus('loading', 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á...');
            
            // Get available cameras
            getCameras();
            
            // Event listeners
            startBtn.onclick = startCamera;
            resetBtn.onclick = resetCounter;
            pauseBtn.onclick = togglePause;
            objectFilterSelect.onchange = (e) => {
                objectFilter = e.target.value;
                updateStatus('ready', `üéØ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö: ${objectFilter === 'all' ? '‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó' : objectFilter}`);
            };
        }

        async function getCameras() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                cameraSelect.innerHTML = '';
                videoDevices.forEach((device, index) => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    option.textContent = device.label || `‡∏Å‡∏•‡πâ‡∏≠‡∏á ${index + 1}`;
                    cameraSelect.appendChild(option);
                });
                
                if (videoDevices.length === 0) {
                    cameraSelect.innerHTML = '<option value="">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</option>';
                }
            } catch (error) {
                console.error('Error getting cameras:', error);
                cameraSelect.innerHTML = '<option value="">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</option>';
            }
        }

        async function startCamera() {
            try {
                updateStatus('loading', 'üé¨ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á...');
                
                const constraints = {
                    video: {
                        width: 800,
                        height: 600,
                        deviceId: cameraSelect.value ? { exact: cameraSelect.value } : undefined
                    }
                };
                
                video = createCapture(constraints);
                video.size(800, 600);
                video.hide();
                
                // Wait for video to be ready
                video.elt.addEventListener('loadeddata', initializeDetector);
                
                startBtn.style.display = 'none';
                pauseBtn.style.display = 'inline-block';
                
            } catch (error) {
                console.error('Error starting camera:', error);
                updateStatus('error', '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á');
            }
        }

        function initializeDetector() {
            updateStatus('loading', 'ü§ñ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î AI Model...');
            
            detector = ml5.objectDetector('cocossd', {}, () => {
                updateStatus('ready', '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÅ‡∏•‡πâ‡∏ß');
                isDetecting = true;
                objectListEl.style.display = 'block';
                detect();
            });
        }

        function detect() {
            if (!isDetecting || !video || isPaused) {
                if (isDetecting && !isPaused) {
                    setTimeout(detect, 100);
                }
                return;
            }
            
            detector.detect(video, (error, results) => {
                if (error) {
                    console.error('Detection error:', error);
                    return;
                }
                
                detections = results || [];
                processDetections();
                setTimeout(detect, 100); // Detect every 100ms
            });
        }

        function processDetections() {
            // Filter detections based on selected object type
            let filteredDetections = detections;
            if (objectFilter !== 'all') {
                filteredDetections = detections.filter(detection => 
                    detection.label.toLowerCase() === objectFilter.toLowerCase()
                );
            }
            
            // Count new objects (simple implementation)
            const currentObjectCount = filteredDetections.length;
            if (currentObjectCount > previousObjects.length) {
                totalObjectsPassed += (currentObjectCount - previousObjects.length);
            }
            
            previousObjects = [...filteredDetections];
            
            // Update UI
            updateStats(filteredDetections);
            updateObjectList(filteredDetections);
        }

        function updateStats(filteredDetections) {
            const currentCount = filteredDetections.length;
            const avgConfidence = filteredDetections.length > 0 
                ? Math.round(filteredDetections.reduce((sum, det) => sum + det.confidence, 0) / filteredDetections.length * 100)
                : 0;
            
            // Calculate FPS
            frameCount++;
            const currentTime = millis();
            if (currentTime - lastTime >= 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
                frameCount = 0;
                lastTime = currentTime;
            }
            
            totalCountEl.textContent = totalObjectsPassed;
            currentCountEl.textContent = currentCount;
            confidenceEl.textContent = avgConfidence + '%';
            fpsEl.textContent = fps;
        }

        function updateObjectList(filteredDetections) {
            detectedObjectsEl.innerHTML = '';
            
            if (filteredDetections.length === 0) {
                detectedObjectsEl.innerHTML = '<div style="text-align: center; opacity: 0.7;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏</div>';
                return;
            }
            
            filteredDetections.forEach((detection, index) => {
                const objectItem = document.createElement('div');
                objectItem.className = 'object-item';
                
                const confidence = Math.round(detection.confidence * 100);
                
                objectItem.innerHTML = `
                    <span>${detection.label} #${index + 1}</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span>${confidence}%</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence}%"></div>
                        </div>
                    </div>
                `;
                
                detectedObjectsEl.appendChild(objectItem);
            });
        }

        function draw() {
            if (video && video.loadedmetadata) {
                // Draw video
                image(video, 0, 0, 800, 600);
                
                // Draw detection boxes
                if (detections.length > 0) {
                    drawDetections();
                }
            } else {
                // Show loading screen
                background(50);
                fill(255);
                textAlign(CENTER, CENTER);
                textSize(24);
                text('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...', width/2, height/2);
            }
        }

        function drawDetections() {
            detections.forEach((detection) => {
                // Skip if filtering and not matching
                if (objectFilter !== 'all' && detection.label.toLowerCase() !== objectFilter.toLowerCase()) {
                    return;
                }
                
                const x = detection.x;
                const y = detection.y;
                const w = detection.width;
                const h = detection.height;
                
                // Draw bounding box
                stroke(0, 255, 0);
                strokeWeight(3);
                noFill();
                rect(x, y, w, h);
                
                // Draw label
                fill(0, 255, 0);
                noStroke();
                textAlign(LEFT, TOP);
                textSize(16);
                const label = `${detection.label} ${Math.round(detection.confidence * 100)}%`;
                
                // Background for text
                fill(0, 0, 0, 150);
                rect(x, y - 25, textWidth(label) + 10, 25);
                
                // Text
                fill(255);
                text(label, x + 5, y - 20);
            });
        }

        function resetCounter() {
            totalObjectsPassed = 0;
            previousObjects = [];
            updateStats([]);
            updateStatus('ready', 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                pauseBtn.textContent = '‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠';
                updateStatus('ready', '‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß');
            } else {
                pauseBtn.textContent = '‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß';
                updateStatus('ready', '‚ñ∂Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏');
                if (isDetecting) detect();
            }
        }

        function updateStatus(type, message) {
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        // Initialize p5.js
        new p5();
    </script>
</body>
</html>